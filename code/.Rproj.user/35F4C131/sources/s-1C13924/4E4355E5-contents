library(textcat)
library(tidyverse)
library(reshape)
library(ggplot2)
library(RMySQL)
library("cld2")
library("cld3")
library("tidytext")
con <- dbConnect(MySQL(),user="twitter",password="password",dbname="twitter",host="52.209.227.60")
on.exit(dbDisconnect(con))
rs <- dbSendQuery(con, "select tweet_text, created_at from tweets;")
data <- fetch(rs, n=Inf) 
summary(data)
data <- data %>% mutate(textcat = textcat(x = tweet_text),
                        cld2 = cld2::detect_language(text = tweet_text, plain_text = FALSE),
                        cld3 = cld3::detect_language(text = tweet_text)) %>%
  select(tweet_text, textcat, cld2, cld3, created_at) %>%
  filter(cld2 == "en" & cld3 == "en")
data$RT <- startsWith(data$tweet_text, "RT") 
data <- data[!data$RT, ]
summary(data)
f <- "%Y-%m-%d %H:%M:%S" 
data$created_at <- as.Date(data$created_at, format=f) 
noTweets <- table(data$created_at)
text_df <- data_frame(date = data$created_at, text = data$tweet_text) 
text_df <- text_df %>% unnest_tokens(word, text) 
afin <- get_sentiments("afinn") 
bing <- get_sentiments("bing") 
nrc <- get_sentiments("nrc") 
afinSent <- text_df %>% inner_join(afin) %>% group_by(index = date) %>% summarise(sentiment = sum(score)) 
bingSent <- text_df %>% inner_join(bing) %>% count(index = date, sentiment) %>% spread(sentiment, n, fill = 0) %>% mutate(sentiment = positive - negative)
nrcSent <- text_df %>% inner_join(nrc) %>% count(index = date, sentiment) %>% spread(sentiment, n, fill = 0) %>% mutate(sentiment = positive - negative)
sentimentTweets <- data.frame(afinSent) 
sentimentTweets <- merge(sentimentTweets, bingSent[,c("index", "sentiment")], by="index") 
sentimentTweets <- merge(sentimentTweets, nrcSent[, c("index", "sentiment")], by="index")
names(sentimentTweets) <- c("date", "afinn", "bing", "nrc") 
tweetData <- melt(sentimentTweets, id="date") 
ggplot(tweetData, aes(x=date, y=value, fill=variable)) + geom_bar(stat='identity', position='dodge')
